.\" Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "Lexical::SealRequireHints 3"
.TH Lexical::SealRequireHints 3 "2021-08-27" "perl v5.18.4" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Lexical::SealRequireHints \- prevent leakage of lexical hints
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\&        use Lexical::SealRequireHints;
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This module works around two historical bugs in Perl's handling of the
\&\f(CW\*(C`%^H\*(C'\fR (lexical hints) variable.  One bug causes lexical state in one
file to leak into another that is \f(CW\*(C`require\*(C'\fRd/\f(CW\*(C`use\*(C'\fRd from it.  This bug,
[perl #68590], was present from Perl 5.6 up to Perl 5.10, fixed in Perl
5.11.0.  The second bug causes lexical state (normally a blank \f(CW\*(C`%^H\*(C'\fR
once the first bug is fixed) to leak outwards from \f(CW\*(C`utf8.pm\*(C'\fR, if it is
automatically loaded during Unicode regular expression matching, into
whatever source is compiling at the time of the regexp match.  This bug,
[perl #73174], was present from Perl 5.8.7 up to Perl 5.11.5, fixed in
Perl 5.12.0.
.PP
Both of these bugs seriously damage the usability of any module relying
on \f(CW\*(C`%^H\*(C'\fR for lexical scoping, on the affected Perl versions.  It is in
practice essential to work around these bugs when using such modules.
On versions of Perl that require such a workaround, this module globally
changes the behaviour of \f(CW\*(C`require\*(C'\fR, including \f(CW\*(C`use\*(C'\fR and the implicit
\&\f(CW\*(C`require\*(C'\fR performed in Unicode regular expression matching, so that it
no longer exhibits these bugs.
.PP
The workaround supplied by this module takes effect the first time its
\&\f(CW\*(C`import\*(C'\fR method is called.  Typically this will be done by means of a
\&\f(CW\*(C`use\*(C'\fR statement.  This should be done as early as possible, because it
only affects \f(CW\*(C`require\*(C'\fR/\f(CW\*(C`use\*(C'\fR statements that are compiled after the
workaround goes into effect.  For \f(CW\*(C`use\*(C'\fR statements, and \f(CW\*(C`require\*(C'\fR
statements that are executed immediately and only once, it suffices
to invoke the workaround when loading the first module that will set
up vulnerable lexical state.  Delayed-action \f(CW\*(C`require\*(C'\fR statements,
however, are more troublesome, and can require the workaround to be loaded
much earlier.  Ultimately, an affected Perl program may need to load
the workaround as very nearly its first action.  Invoking this module
multiple times, from multiple modules, is not a problem: the workaround
is only applied once, and applies to everything subsequently compiled.
.PP
This module is implemented in \s-1XS,\s0 with a pure Perl backup version for
systems that can't handle \s-1XS\s0 modules.  The \s-1XS\s0 version has a better chance
of playing nicely with other modules that modify \f(CW\*(C`require\*(C'\fR handling.
The pure Perl version can't work at all on some Perl versions; users of
those versions must use the \s-1XS.\s0
.SH "PERL VERION DIFFERENCES"
.IX Header "PERL VERION DIFFERENCES"
The history of the \f(CW\*(C`%^H\*(C'\fR bugs is complex.  Here is a chronological
statement of the relevant changes.
.IP "Perl 5.6.0" 4
.IX Item "Perl 5.6.0"
\&\f(CW\*(C`%^H\*(C'\fR introduced.  It exists only as a hash at compile time.  It is not
localised by \f(CW\*(C`require\*(C'\fR, so lexical hints leak into every module loaded,
which is bug [perl #68590].
.Sp
The \f(CW\*(C`CORE::GLOBAL\*(C'\fR mechanism doesn't work cleanly for \f(CW\*(C`require\*(C'\fR, because
overriding \f(CW\*(C`require\*(C'\fR loses the necessary special parsing of bareword
arguments to it.  As a result, pure Perl code can't properly globally
affect the behaviour of \f(CW\*(C`require\*(C'\fR.  Pure Perl code can localise \f(CW\*(C`%^H\*(C'\fR
itself for any particular \f(CW\*(C`require\*(C'\fR invocation, but a global fix is
only possible through \s-1XS.\s0
.IP "Perl 5.7.2" 4
.IX Item "Perl 5.7.2"
The \f(CW\*(C`CORE::GLOBAL\*(C'\fR mechanism now works cleanly for \f(CW\*(C`require\*(C'\fR, so pure
Perl code can globally affect the behaviour of \f(CW\*(C`require\*(C'\fR to achieve a
global fix for the bug.
.IP "Perl 5.8.7" 4
.IX Item "Perl 5.8.7"
When \f(CW\*(C`utf8.pm\*(C'\fR is automatically loaded during Unicode regular expression
matching, \f(CW\*(C`%^H\*(C'\fR now leaks outward from it into whatever source is
compiling at the time of the regexp match, which is bug [perl #73174].
It often goes unnoticed, because [perl #68590] makes \f(CW\*(C`%^H\*(C'\fR leak into
\&\f(CW\*(C`utf8.pm\*(C'\fR which then doesn't modify it, so what leaks out tends to
be identical to what leaked in.  If [perl #68590] is worked around,
however, \f(CW\*(C`%^H\*(C'\fR tends to be (correctly) blank inside \f(CW\*(C`utf8.pm\*(C'\fR, and
this bug therefore blanks it for the outer module.
.IP "Perl 5.9.4" 4
.IX Item "Perl 5.9.4"
\&\f(CW\*(C`%^H\*(C'\fR now exists in two forms.  In addition to the relatively ordinary
hash that is modified during compilation, the value that it had at
each point in compilation is recorded in the compiled op tree, for later
examination at runtime.  It is in a special representation-sharing format,
and writes to \f(CW\*(C`%^H\*(C'\fR are meant to be performed on both forms.  \f(CW\*(C`require\*(C'\fR
does not localise the runtime form of \f(CW\*(C`%^H\*(C'\fR (and still doesn't localise
the compile-time form).
.Sp
A couple of special \f(CW\*(C`%^H\*(C'\fR entries are erroneously written only to the
runtime form.
.Sp
Pure Perl code, although it can localise the compile-time \f(CW\*(C`%^H\*(C'\fR by
normal means, can't adequately localise the runtime \f(CW\*(C`%^H\*(C'\fR, except by
using a string eval stack frame.  This makes a satisfactory global fix
for the leakage bug impossible in pure Perl.
.IP "Perl 5.10.1" 4
.IX Item "Perl 5.10.1"
\&\f(CW\*(C`require\*(C'\fR now properly localises the runtime form of \f(CW\*(C`%^H\*(C'\fR, but still
not the compile-time form.
.Sp
A global fix is once again possible in pure Perl, because the fix only
needs to localise the compile-time form.
.IP "Perl 5.11.0" 4
.IX Item "Perl 5.11.0"
\&\f(CW\*(C`require\*(C'\fR now properly localises both forms of \f(CW\*(C`%^H\*(C'\fR, fixing [perl
#68590].  This makes [perl #73174] apparent without any workaround for
[perl #68590].
.Sp
The special \f(CW\*(C`%^H\*(C'\fR entries are now correctly written to both forms of
the hash.
.IP "Perl 5.12.0" 4
.IX Item "Perl 5.12.0"
The automatic loading of \f(CW\*(C`utf8.pm\*(C'\fR during Unicode regular expression
matching now properly restores \f(CW\*(C`%^H\*(C'\fR, fixing [perl #73174].
.SH "BUGS"
.IX Header "BUGS"
The operation of this module depends on influencing the compilation of
\&\f(CW\*(C`require\*(C'\fR.  As a result, it cannot prevent lexical state leakage through
a \f(CW\*(C`require\*(C'\fR statement that was compiled before this module was invoked.
Where problems occur, this module must be invoked earlier.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
perlpragma
.SH "AUTHOR"
.IX Header "AUTHOR"
Andrew Main (Zefram) <zefram@fysh.org>
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2009, 2010, 2011, 2012
Andrew Main (Zefram) <zefram@fysh.org>
.SH "LICENSE"
.IX Header "LICENSE"
This module is free software; you can redistribute it and/or modify it
under the same terms as Perl itself.
